<!DOCTYPE html>
<html>
<head>
    <title>üè† Red Cross Disaster Response Map</title>
    <meta charset="utf-8">
    <style>
        body { margin: 0; font-family: Arial, sans-serif; }
        .header {
            background: #d32f2f;
            color: white;
            padding: 15px;
            text-align: center;
            font-weight: bold;
        }
        .controls {
            background: #f5f5f5;
            padding: 10px;
            text-align: center;
        }
        .status {
            padding: 20px;
            text-align: center;
            font-size: 18px;
        }
        .event-list {
            max-width: 800px;
            margin: 20px auto;
            padding: 0 20px;
        }
        .event {
            background: white;
            border: 2px solid #d32f2f;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .event-type {
            font-weight: bold;
            color: #d32f2f;
            font-size: 16px;
            margin-bottom: 8px;
        }
        .event-details {
            color: #333;
            line-height: 1.4;
        }
        .coordinates {
            background: #f0f0f0;
            padding: 5px 10px;
            border-radius: 4px;
            font-family: monospace;
            margin-top: 8px;
        }
        .no-events {
            color: #4caf50;
            font-size: 20px;
            text-align: center;
            padding: 40px;
        }
        button {
            background: #d32f2f;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="header">
        üè† American Red Cross - Disaster Response Map
        <br>CONUS | Alaska | Hawaii | US Territories Only
    </div>
    
    <div class="controls">
        <button onclick="loadUSDisasters()">üîÑ Check for Active US Disasters</button>
        <span style="margin-left: 20px;">Last updated: <span id="lastUpdate">Never</span></span>
    </div>
    
    <div id="status" class="status">
        Click "Check for Active US Disasters" to scan for events requiring shelter response
    </div>
    
    <div id="eventsList" class="event-list"></div>
    
    <script>
        async function loadUSDisasters() {
            document.getElementById('status').innerHTML = 'üîç Scanning for US disasters requiring shelter response...';
            document.getElementById('eventsList').innerHTML = '';
            
            const disasters = [];
            
            // Check NOAA weather alerts for shelter-triggering events
            try {
                const response = await fetch('https://api.weather.gov/alerts/active');
                const data = await response.json();
                
                const shelterEvents = [
                    'Hurricane Warning', 'Hurricane Watch', 'Tornado Warning',
                    'Flash Flood Warning', 'Flood Warning', 'Blizzard Warning',
                    'Ice Storm Warning', 'Severe Thunderstorm Warning'
                ];
                
                for (const alert of data.features) {
                    const props = alert.properties;
                    const event = props.event || '';
                    const severity = props.severity || '';
                    
                    if (shelterEvents.includes(event) || severity === 'Extreme') {
                        const geometry = alert.geometry;
                        if (geometry && geometry.type === 'Polygon') {
                            const coords = geometry.coordinates[0];
                            const centerLat = coords.reduce((sum, p) => sum + p[1], 0) / coords.length;
                            const centerLon = coords.reduce((sum, p) => sum + p[0], 0) / coords.length;
                            
                            // Check if in US territory (rough bounds)
                            if (centerLat >= 18.9 && centerLat <= 71.4 && 
                                centerLon >= -179.0 && centerLon <= -66.9) {
                                
                                disasters.push({
                                    type: 'WEATHER EMERGENCY',
                                    event: event,
                                    severity: severity,
                                    area: props.areaDesc || 'Unknown area',
                                    headline: props.headline || '',
                                    expires: props.expires || '',
                                    lat: centerLat.toFixed(3),
                                    lon: centerLon.toFixed(3),
                                    shelterRequired: true
                                });
                            }
                        }
                    }
                }
            } catch (error) {
                console.error('Error fetching weather alerts:', error);
            }
            
            // Check USGS for significant earthquakes in US
            try {
                const response = await fetch('https://earthquake.usgs.gov/earthquakes/feed/v1.0/summary/significant_day.geojson');
                const data = await response.json();
                
                for (const quake of data.features) {
                    const props = quake.properties;
                    const coords = quake.geometry.coordinates;
                    const mag = props.mag || 0;
                    
                    // US territory bounds check
                    if (coords[1] >= 18.9 && coords[1] <= 71.4 && 
                        coords[0] >= -179.0 && coords[0] <= -66.9 && 
                        mag >= 5.0) {
                        
                        disasters.push({
                            type: 'MAJOR EARTHQUAKE',
                            magnitude: mag,
                            location: props.place || 'Unknown location',
                            time: new Date(props.time).toLocaleString(),
                            lat: coords[1].toFixed(3),
                            lon: coords[0].toFixed(3),
                            shelterRequired: mag >= 6.0
                        });
                    }
                }
            } catch (error) {
                console.error('Error fetching earthquake data:', error);
            }
            
            // Display results
            document.getElementById('lastUpdate').textContent = new Date().toLocaleString();
            
            if (disasters.length === 0) {
                document.getElementById('status').innerHTML = 
                    '<div class="no-events">‚úÖ No major disasters currently requiring Red Cross shelter response in US territory</div>';
            } else {
                document.getElementById('status').innerHTML = 
                    `<div style="color: #d32f2f; font-weight: bold;">üö® ${disasters.length} ACTIVE DISASTERS REQUIRING SHELTER RESPONSE</div>`;
                
                const eventsList = document.getElementById('eventsList');
                disasters.forEach((disaster, index) => {
                    const eventDiv = document.createElement('div');
                    eventDiv.className = 'event';
                    
                    let content = `<div class="event-type">${index + 1}. ${disaster.type}</div>`;
                    content += '<div class="event-details">';
                    
                    if (disaster.type === 'WEATHER EMERGENCY') {
                        content += `<strong>Event:</strong> ${disaster.event}<br>`;
                        content += `<strong>Severity:</strong> ${disaster.severity}<br>`;
                        content += `<strong>Area:</strong> ${disaster.area}<br>`;
                        if (disaster.expires) {
                            content += `<strong>Expires:</strong> ${disaster.expires}<br>`;
                        }
                    } else if (disaster.type === 'MAJOR EARTHQUAKE') {
                        content += `<strong>Magnitude:</strong> ${disaster.magnitude}<br>`;
                        content += `<strong>Location:</strong> ${disaster.location}<br>`;
                        content += `<strong>Time:</strong> ${disaster.time}<br>`;
                    }
                    
                    content += `<div class="coordinates">üìç ${disaster.lat}, ${disaster.lon}</div>`;
                    if (disaster.shelterRequired) {
                        content += '<div style="color: #d32f2f; font-weight: bold; margin-top: 8px;">üè† SHELTER DEPLOYMENT RECOMMENDED</div>';
                    }
                    
                    content += '</div>';
                    eventDiv.innerHTML = content;
                    eventsList.appendChild(eventDiv);
                });
            }
        }
    </script>
</body>
</html>